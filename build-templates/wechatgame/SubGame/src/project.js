require=function r(i,l,c){function s(t,e){if(!l[t]){if(!i[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(p)return p(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var a=l[t]={exports:{}};i[t][0].call(a.exports,function(e){return s(i[t][1][e]||e)},a,a.exports,r,i,l,c)}return l[t].exports}for(var p="function"==typeof require&&require,e=0;e<c.length;e++)s(c[e]);return s}({CanvasCtr:[function(e,t,n){"use strict";cc._RF.push(t,"5dd8fAmjN5ItpUb3XWnz0dS","CanvasCtr"),Object.defineProperty(n,"__esModule",{value:!0});var o,a,r=e("./Ranking"),i=cc._decorator,l=i.ccclass,c=i.property;(a=o||(o={}))[a.Get_SelfData=0]="Get_SelfData",a[a.Get_FriendData=1]="Get_FriendData",a[a.Get_GroupData=2]="Get_GroupData",a[a.Submit_SelfScore=3]="Submit_SelfScore",a[a.Compare_Score=4]="Compare_Score",a[a.Show_WholeRanking=5]="Show_WholeRanking",a[a.Show_OverRanking=6]="Show_OverRanking",a[a.Close_WholeRanking=7]="Close_WholeRanking",a[a.Close_OverRanking=8]="Close_OverRanking";var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mRanking=null,e.mSelfData=null,e.mSelfRank=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.handleWxMessage()},e.prototype.handleWxMessage=function(){var t=this;null!=window.wx&&window.wx.onMessage(function(e){console.log("收到主域消息"),e.messageType==o.Get_FriendData?t.getFriendData(e.SCORE_KEY,e.LOCATION_KEY):e.messageType==o.Get_GroupData?t.getGroupData(e.SCORE_KEY,e.shareTicket):e.messageType==o.Submit_SelfScore?t.submitScore(e.score,e.SCORE_KEY,e.location,e.LOCATION_KEY):e.messageType==o.Show_WholeRanking?t.showFriendRanking(e.page):e.messageType==o.Get_SelfData?t.getSelfData():e.messageType==o.Close_WholeRanking&&t.closeFriendRanking()})},e.prototype.onDestroy=function(){},e.prototype.getSelfData=function(){var n=this;console.log("获取自己信息！！！！！！！！！！！！！"),null!=window.wx&&window.wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){console.log("获取自己信息成功！！！！！！！！！！！！！",e);var t=e.data[0];n.mSelfData=t},fail:function(e){console.log("获取自己信息失败！！！！！！！！！！！！！")}})},e.prototype.getFriendData=function(e,t,n){var o=this;void 0===n&&(n=!1),console.log("获取好友排行榜数据！！！！！！！！！！！！！"),null!=window.wx&&window.wx.getFriendCloudStorage({keyList:[e,t],success:function(e){console.log("获取好友排行榜数据成功",e);var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[1].value-e.KVDataList[1].value}),o.mFriendRankData=t,n&&o.showFriendRanking()},fail:function(e){console.log("获取好友排行榜数据失败")}})},e.prototype.getGroupData=function(t,n){var o=this;null!=window.wx&&window.wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){window.wx.getGroupCloudStorage({shareTicket:n,keyList:[t],success:function(e){console.log("wx.getGroupCloudStorage success",e);var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[1].value-e.KVDataList[1].value}),o.mGroupData=t},fail:function(e){console.log("wx.getFriendCloudStorage fail",e)}})}})},e.prototype.submitScore=function(t,n,o,a){console.log("提交分数"),null!=window.wx?window.wx.getUserCloudStorage({keyList:[n,a],success:function(e){console.log("提交分数成功",e),0!=e.KVDataList.length&&e.KVDataList[0].value>t||window.wx.setUserCloudStorage({KVDataList:[{key:n,value:""+t},{key:a,value:o}],success:function(e){console.log("setUserCloudStorage","success",e)}})},fail:function(e){console.log("提交分数失败","fail")},complete:function(e){console.log("提交分数完成","ok")}}):cc.log("提交得分:"+n+" : "+t)},e.prototype.closeFriendRanking=function(){this.mRanking.clear()},e.prototype.showFriendRanking=function(e){if(void 0===e&&(e=1),console.log("显示好友排行榜",this.mFriendRankData),!this.mFriendRankData)return console.log("没有好友排行榜信息，请先获取好友排行榜信息"),void this.getFriendData("Rank_SCORE","LOACTION",!0);this.closeFriendRanking(),console.log("page == ",e),this.getSelfRank(),this.mRanking.loadRanking(this.mFriendRankData)},e.prototype.getSelfRank=function(){var e=0;if(this.mSelfData)for(var t=0;t<this.mFriendRankData.length;t++){var n=this.mFriendRankData[t];n.avatarUrl==this.mSelfData.avatarUrl&&(e=t,this.mSelfData=n,this.mRanking.showSelf(n,t))}return e},__decorate([c(r.default)],e.prototype,"mRanking",void 0),e=__decorate([l],e)}(cc.Component);n.default=s,cc._RF.pop()},{"./Ranking":"Ranking"}],RankingCell:[function(e,t,n){"use strict";cc._RF.push(t,"61afc7jnvBPqLy8NzGSRn2f","RankingCell"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,r=o.property,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprBg=null,e.sprMedal=null,e.sprHead=null,e.lbRank=null,e.lbName=null,e.lbLocation=null,e.lbScore=null,e.medalFrames=[],e}return __extends(e,t),e.prototype.setData=function(e,t){if(console.log("rankingCell data == ",t),this.createImage(t.avatarUrl),this.lbName.string=this.cutstr(t.nickname,10),this.setMedal(e),t.KVDataList){var n=0!=t.KVDataList.length?t.KVDataList[1].value:0;n=parseInt(n),this.lbScore.string=this.formatNum(n)}},e.prototype.setMedal=function(e){e<3?(this.sprMedal.node.active=!0,this.sprMedal.spriteFrame=this.medalFrames[e],this.lbRank.node.active=!1):(this.lbRank.node.active=!0,this.lbRank.string=e+1,this.sprMedal.node.active=!1)},e.prototype.createImage=function(e){var n=this;if(null!=window.wx)try{var t=wx.createImage();t.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(t),e.handleLoadedTexture(),n.sprHead.spriteFrame=new cc.SpriteFrame(e)}catch(e){cc.log(e),n.sprHead.node.active=!1}},t.src=e}catch(e){cc.log(e),this.sprHead.node.active=!1}else cc.loader.load({url:e,type:"jpg"},function(e,t){n.sprHead.spriteFrame=new cc.SpriteFrame(t)})},e.prototype.cutstr=function(e,t){var n,o=0,a=new String;n=e.length;for(var r=0;r<n;r++){var i=e.charAt(r);if(o++,4<escape(i).length&&o++,a=a.concat(i),t<o)return a=a.concat("...")}return e},e.prototype.formatNum=function(e,t){return void 0===t&&(t=6),(e=Math.floor(e))>=Math.pow(10,t)&&e<Math.pow(10,t+3)?(e=Math.floor(e/1e3),e=this.getString(e)+"k"):e>=Math.pow(10,t+3)&&e<Math.pow(10,t+6)?(e=Math.floor(e/1e6),e=this.getString(e)+"M"):e>=Math.pow(10,t+6)?(e=Math.floor(e/1e9),e=this.getString(e)+"B"):e>=Math.pow(10,t+9)?(e=Math.floor(e/1e12),e=this.getString(e)+"AA"):e=this.getString(e),e},e.prototype.getString=function(e){for(var t="",n=e=(e||0).toString();3<n.length;)t=","+n.slice(-3)+t,n=n.slice(0,n.length-3);return n&&(t=n+t),t},__decorate([r(cc.Sprite)],e.prototype,"sprBg",void 0),__decorate([r(cc.Sprite)],e.prototype,"sprMedal",void 0),__decorate([r(cc.Sprite)],e.prototype,"sprHead",void 0),__decorate([r(cc.Label)],e.prototype,"lbRank",void 0),__decorate([r(cc.Label)],e.prototype,"lbName",void 0),__decorate([r(cc.Label)],e.prototype,"lbLocation",void 0),__decorate([r(cc.Label)],e.prototype,"lbScore",void 0),__decorate([r([cc.SpriteFrame])],e.prototype,"medalFrames",void 0),e=__decorate([a],e)}(cc.Component);n.default=i,cc._RF.pop()},{}],Ranking:[function(e,t,n){"use strict";cc._RF.push(t,"f4f54uObghLbJK7HnlIlACQ","Ranking"),Object.defineProperty(n,"__esModule",{value:!0});var a=e("./RankingCell"),o=cc._decorator,r=o.ccclass,i=o.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ndContent=null,e.pfCell=null,e.ndSelf=null,e}return __extends(e,t),e.prototype.loadRanking=function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n&&0<n.KVDataList.length){var o=cc.instantiate(this.pfCell);this.ndContent.addChild(o),o.getComponent(a.default).setData(t,n)}}},e.prototype.showSelf=function(e,t){this.ndSelf.getComponent(a.default).setData(t,e)},e.prototype.clear=function(){this.ndContent.removeAllChildren()},e.prototype.onLoad=function(){},e.prototype.start=function(){},__decorate([i(cc.Node)],e.prototype,"ndContent",void 0),__decorate([i(cc.Prefab)],e.prototype,"pfCell",void 0),__decorate([i(cc.Node)],e.prototype,"ndSelf",void 0),e=__decorate([r],e)}(cc.Component);n.default=l,cc._RF.pop()},{"./RankingCell":"RankingCell"}]},{},["CanvasCtr","Ranking","RankingCell"]);