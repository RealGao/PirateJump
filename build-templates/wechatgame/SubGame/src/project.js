require=function r(i,s,c){function l(t,e){if(!s[t]){if(!i[t]){var a="function"==typeof require&&require;if(!e&&a)return a(t,!0);if(d)return d(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var o=s[t]={exports:{}};i[t][0].call(o.exports,function(e){return l(i[t][1][e]||e)},o,o.exports,r,i,s,c)}return s[t].exports}for(var d="function"==typeof require&&require,e=0;e<c.length;e++)l(c[e]);return l}({CanvasCtr:[function(e,t,a){"use strict";cc._RF.push(t,"5dd8fAmjN5ItpUb3XWnz0dS","CanvasCtr"),Object.defineProperty(a,"__esModule",{value:!0});var n,o,l,r,s=e("./rankItem"),i=cc._decorator,c=i.ccclass,d=i.property;(o=n||(n={}))[o.Get_SelfData=0]="Get_SelfData",o[o.Get_FriendData=1]="Get_FriendData",o[o.Get_GroupData=2]="Get_GroupData",o[o.Submit_SelfScore=3]="Submit_SelfScore",o[o.Compare_Score=4]="Compare_Score",o[o.Show_WholeRanking=5]="Show_WholeRanking",o[o.Show_MiniRanking=6]="Show_MiniRanking",o[o.Close_WholeRanking=7]="Close_WholeRanking",o[o.Close_MiniRanking=8]="Close_MiniRanking",o[o.Show_recorder=9]="Show_recorder",o[o.Close_recorder=10]="Close_recorder",(r=l||(l={}))[r.Game=0]="Game",r[r.Over=1]="Over";var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ndRank=null,e.ndRecorder=null,e.pfRankItem=null,e.pfRecorder=null,e.ndBeyond=null,e.ndMiniRank=null,e.mSelfData=null,e.mSelfRank=null,e.ranks=[[],[],[],[]],e}return __extends(e,t),e.prototype.onLoad=function(){this.handleWxMessage()},e.prototype.handleWxMessage=function(){var t=this;null!=window.wx&&window.wx.onMessage(function(e){console.log("log----------onMessage--data=:",e),e.messageType==n.Get_FriendData?t.getFriendData(e.SCORE_KEY1,e.SCORE_KEY2,e.SCORE_KEY3,e.SCORE_KEY4):e.messageType==n.Get_GroupData?t.getGroupData(e.LIST_KEY,e.shareTicket):e.messageType==n.Submit_SelfScore?(console.log("log--------handleWxMessage data=:",e),t.submitScore(e.score1,e.SCORE_KEY1,e.score2,e.SCORE_KEY2,e.score3,e.SCORE_KEY3,e.score4,e.SCORE_KEY4)):e.messageType==n.Compare_Score?t.compareWithScore(e.mapIndex,e.score,e.type):e.messageType==n.Show_WholeRanking?t.showFriendRanking(e.map,e.page):e.messageType==n.Show_MiniRanking?t.showMiniRanking(e.map):e.messageType==n.Get_SelfData?t.getSelfData():e.messageType==n.Close_WholeRanking?t.closeFriendRanking():e.messageType==n.Close_MiniRanking?t.closeMiniRanking():e.messageType==n.Show_recorder?t.showMapsRecorder():e.messageType==n.Close_recorder&&t.closeMapsRecorder()})},e.prototype.onDestroy=function(){},e.prototype.getSelfData=function(){var a=this;console.log("获取自己信息！！！！！！！！！！！！！"),null!=window.wx&&window.wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){console.log("获取自己信息成功！！！！！！！！！！！！！",e);var t=e.data[0];a.mSelfData=t},fail:function(e){console.log("获取自己信息失败！！！！！！！！！！！！！")}})},e.prototype.getFriendData=function(e,t,a,n){var o=this;console.log("获取好友排行榜数据！！！！！！！！！！！！！"),null!=window.wx&&window.wx.getFriendCloudStorage({keyList:[e,t,a,n],success:function(e){console.log("获取好友排行榜数据成功"),console.log("wx.getFriendCloudStorage success",e);var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value}),o.mFriendRankData=t,o.doData()},fail:function(e){console.log("获取好友排行榜数据失败")}})},e.prototype.getGroupData=function(t,a){var n=this;null!=window.wx&&window.wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){window.wx.getGroupCloudStorage({shareTicket:a,keyList:[t],success:function(e){console.log("wx.getGroupCloudStorage success",e);var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value}),n.mGroupData=t,n.showGroupRanking()},fail:function(e){console.log("wx.getFriendCloudStorage fail",e)}})}})},e.prototype.submitScore=function(t,a,n,o,r,i,s,c){null!=window.wx&&window.wx.getUserCloudStorage({keyList:[a,o,i,c],success:function(e){console.log("提交分数成功",e),window.wx.setUserCloudStorage({KVDataList:[{key:a,value:""+t},{key:o,value:""+n},{key:i,value:""+r},{key:c,value:""+s}],success:function(e){console.log("setUserCloudStorage","success",e)},fail:function(e){console.log("setUserCloudStorage","fail")},complete:function(e){console.log("setUserCloudStorage","ok")}})},fail:function(e){console.log("提交分数失败","fail")},complete:function(e){console.log("提交分数完成","ok")}})},e.prototype.compareWithScore=function(e,t,a){var n;this.ndRank.active=!1,this.ndRecorder.active=!1,this.ndMiniRank.active=!1,this.ndBeyond.active=!0,a==l.Game?(n=this.ndBeyond.getChildByName("ndGame"),this.ndBeyond.getChildByName("ndOver").active=!1,n.getChildByName("bb").active=!1,n.getChildByName("beyond2").active=!0):(n=this.ndBeyond.getChildByName("ndOver"),this.ndBeyond.getChildByName("ndGame").active=!1),n.active=!0;var o=this.ranks[e];console.log("this.mSelfData.avatarUrl == ",this.mSelfData.avatarUrl);for(var r=o.length-1;0<=r;r--){var i=o[r];if(i.data.avatarUrl!=this.mSelfData.avatarUrl&&i.data.score>t){var s=n.getChildByName("sprFriend").getComponent(cc.Sprite);this.createImage(i.data.avatarUrl,s,s.node),n.getChildByName("lbScore").getComponent(cc.Label).string=""+i.data.score;var c=n.getChildByName("lbName");if(c)c.getComponent(cc.Label).string=this.cutstr(i.data.nickname,8);return}}if(a==l.Game){n.getChildByName("bb").active=!0,n.getChildByName("beyond2").active=!1;s=n.getChildByName("sprFriend").getComponent(cc.Sprite);this.createImage(this.mSelfData.avatarUrl,s,s.node),n.getChildByName("lbName").getComponent(cc.Label).string=this.cutstr(this.mSelfData.nickname,8)}else this.ndBeyond.active=!1},e.prototype.showFriendRanking=function(e,t){if(void 0===t&&(t=0),console.log("log-----showFriendRanking mapindex page=:",e,t),this.ndRank.active=!0,this.ndRecorder.active=!1,this.ndBeyond.active=!1,this.ndMiniRank.active=!1,!(6*t>this.ranks[e].length)){this.ndRank.removeAllChildren();for(var a=6*t,n=a+6>this.ranks[e].length?this.ranks[e].length:a+6,o=a;o<n;o++){console.log("log--------create friendItemIndex=:",o);var r=cc.instantiate(this.pfRankItem);r.parent=this.ndRank,r.x=-11,r.y=280-o%6*91.5,r.getComponent("rankItem").setModel(e),r.getComponent("rankItem").setRank(o+1),r.getComponent("rankItem").setName(this.ranks[e][o].data.nickname),r.getComponent("rankItem").setScore(this.ranks[e][o].data.score),r.getComponent("rankItem").setHeadImg(this.ranks[e][o].data.avatarUrl)}}},e.prototype.closeFriendRanking=function(){},e.prototype.showMiniRanking=function(e){this.ndRank.active=!1,this.ndRecorder.active=!1,this.ndBeyond.active=!1,this.ndMiniRank.active=!0;var t=this.ranks[e],a=this.getSelfRank(e);console.log("selfRank == ",a);for(var n=0;n<t.length;n++){var o=t[n],r=null;if(n==a?r=this.ndMiniRank.children[1]:n==a+1?r=this.ndMiniRank.children[2]:n==a-1&&(r=this.ndMiniRank.children[0]),r){r.active=!0;var i=r.getComponent(s.default);i.setRank(n+1),i.setScore(o.data.score),i.setHeadImg(o.data.avatarUrl)}}},e.prototype.closeMiniRanking=function(){for(var e=0;e<this.ndMiniRank.childrenCount;e++){this.ndMiniRank.children[e].active=!1}this.ndMiniRank.active=!1},e.prototype.getSelfRank=function(e){var t=this.ranks[e],a=0;if(this.mSelfData)for(var n=0;n<t.length;n++){if(t[n].data.avatarUrl==this.mSelfData.avatarUrl){a=n;break}}return a},e.prototype.showGroupRanking=function(){},e.prototype.doData=function(){for(var e=0;e<this.ranks.length;e++)this.ranks[e].splice(0,this.ranks[e].length);for(e=0;e<this.mFriendRankData.length;e++)for(var t=0;t<this.mFriendRankData[e].KVDataList.length;t++)if(this.mFriendRankData[e].KVDataList[t].value&&"null"!=this.mFriendRankData[e].KVDataList[t].value){var a={score:this.mFriendRankData[e].KVDataList[t].value,avatarUrl:this.mFriendRankData[e].avatarUrl,nickname:this.mFriendRankData[e].nickname};this.ranks[t].push({data:a})}for(e=0;e<this.ranks.length;e++)this.ranks[e].sort(function(e,t){return Number(e.data.score)<Number(t.data.score)?1:Number(e.data.score)>Number(t.data.score)?-1:0});console.log("log--------------this.ranks=:",this.ranks)},e.prototype.showMapsRecorder=function(){console.log("log--------------子域 显示地图最高得分记录-------"),this.ndRecorder.active=!0,this.ndRank.active=!1,this.ndBeyond.active=!1,this.ndMiniRank.active=!1,this.ndRecorder.removeAllChildren();var e=cc.instantiate(this.pfRecorder);e.parent=this.ndRecorder;for(var t=0;t<4;t++){var a=e.getChildByName("lb_score"+t),n=e.getChildByName("headFram"+t),o=n.getChildByName("head");if(1<=this.ranks[t].length){console.log("子域 显示地图最高得分记录--",this.ranks[t][0].data.score),a.getComponent(cc.Label).string=this.ranks[t][0].data.score;var r=o.getComponent(cc.Sprite);this.createImage(this.ranks[t][0].data.avatarUrl,r,o)}else a.active=!1,n.active=!1}},e.prototype.closeMapsRecorder=function(){this.ndRecorder.active=!1},e.prototype.cutstr=function(e,t){var a,n=0,o=new String;a=e.length;for(var r=0;r<a;r++){var i=e.charAt(r);if(n++,4<escape(i).length&&n++,o=o.concat(i),t<n)return o=o.concat(".")}return e},e.prototype.createImage=function(e,a,t){if(null!=window.wx)try{var n=wx.createImage();n.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(n),e.handleLoadedTexture(),a.spriteFrame=new cc.SpriteFrame(e)}catch(e){cc.log(e),t.active=!1}},n.src=e}catch(e){cc.log(e),t.active=!1}else cc.loader.load({url:e,type:"jpg"},function(e,t){a.spriteFrame=new cc.SpriteFrame(t)})},__decorate([d(cc.Node)],e.prototype,"ndRank",void 0),__decorate([d(cc.Node)],e.prototype,"ndRecorder",void 0),__decorate([d(cc.Prefab)],e.prototype,"pfRankItem",void 0),__decorate([d(cc.Prefab)],e.prototype,"pfRecorder",void 0),__decorate([d(cc.Node)],e.prototype,"ndBeyond",void 0),__decorate([d(cc.Node)],e.prototype,"ndMiniRank",void 0),e=__decorate([c],e)}(cc.Component);a.default=p,cc._RF.pop()},{"./rankItem":"rankItem"}],RankingCell:[function(e,t,a){"use strict";cc._RF.push(t,"61afc7jnvBPqLy8NzGSRn2f","RankingCell"),Object.defineProperty(a,"__esModule",{value:!0});var n=cc._decorator,o=n.ccclass,r=n.property,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprBg=null,e.sprBg0=null,e.sprBg1=null,e.sprMedal=null,e.sprHead=null,e.lbRank=null,e.lbName=null,e.lbScore=null,e.lbGrade=null,e.lbtitle=null,e.medalFrames=[],e.bgFrames=[],e.gradeList=["王\n者","宗\n师","大\n师","进\n阶","入\n门","渣\n渣"],e}return __extends(e,t),e.prototype.setData=function(e,t,a){if(this.createImage(t.avatarUrl),this.lbName.string=this.cutstr(t.nickname,10),this.setMedal(e),a&&this.setBg(e),t.KVDataList){var n=0!=t.KVDataList.length?t.KVDataList[0].value:0;n=this.formatNum(n),this.lbScore.string=n}},e.prototype.setOverData=function(e,t){if(t.KVDataList){this.createImage(t.avatarUrl),this.lbName.string=this.cutstr(t.nickname,10),this.setMedal(e);var a=e%2;this.sprBg.spriteFrame=this.bgFrames[a];var n=0!=t.KVDataList.length?t.KVDataList[0].value:0;return n=this.formatNum(n),this.lbScore.string=n,this.setLbGrade(n)}},e.prototype.setSelfOverData=function(e){if(e.KVDataList){this.createImage(e.avatarUrl),this.lbName.string=this.cutstr(e.nickname,10);var t=0!=e.KVDataList.length?e.KVDataList[0].value:0;this.setLbGrade(t)}},e.prototype.setLbGrade=function(e){var t=this.lbGrade.getComponent(cc.Label);return e<2e3?(t.string=this.gradeList[5],5):2e3<=e&&e<1e4?(t.string=this.gradeList[4],4):1e4<=e&&e<3e4?(t.string=this.gradeList[3],3):3e4<=e&&e<5e4?(t.string=this.gradeList[2],2):5e4<=e&&e<8e4?(t.string=this.gradeList[1],1):1e5<=e?(t.string=this.gradeList[0],0):void 0},e.prototype.setTitle=function(e){this.sprBg.node.active=!1,this.lbtitle.getComponent(cc.Label).string=e},e.prototype.setBg=function(e){this.sprBg.spriteFrame=this.bgFrames[0]},e.prototype.setMedal=function(e){e<3?(this.sprMedal.node.active=!0,this.sprMedal.spriteFrame=this.medalFrames[e],this.lbRank.node.active=!1):(this.lbRank.node.active=!0,this.lbRank.string=""+(e+1),this.sprMedal.node.active=!1),1==(e%=2)?this.sprBg1.active=!0:this.sprBg0.active=!0},e.prototype.createImage=function(e){var a=this;if(null!=window.wx)try{var t=wx.createImage();t.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(t),e.handleLoadedTexture(),a.sprHead.spriteFrame=new cc.SpriteFrame(e)}catch(e){cc.log(e),a.sprHead.node.active=!1}},t.src=e}catch(e){cc.log(e),this.sprHead.node.active=!1}else cc.loader.load({url:e,type:"jpg"},function(e,t){a.sprHead.spriteFrame=new cc.SpriteFrame(t)})},e.prototype.cutstr=function(e,t){var a,n=0,o=new String;a=e.length;for(var r=0;r<a;r++){var i=e.charAt(r);if(n++,4<escape(i).length&&n++,o=o.concat(i),t<n)return o=o.concat("...")}return e},e.prototype.formatNum=function(e){if(console.log("0",e),1e15<=(e=Math.floor(e))){for(var t=this.getDigitOfNum(e);t%3!=0;)t--;console.log("1",t),e=Math.floor(e/Math.pow(10,t-3)),console.log("2",e);var a=t/3-5+65,n=String.fromCharCode(a);console.log("3",a,n),e=this.getString(e)+""+n+n}else 1e12<=e?(e=Math.floor(e/1e9),e=this.getString(e)+"B"):1e9<=e?(e=Math.floor(e/1e6),e=this.getString(e)+"M"):1e6<=e?(e=Math.floor(e/1e3),e=this.getString(e)+"k"):e=this.getString(e);return e},e.prototype.getDigitOfNum=function(e){for(var t=0;0!=e;)e=Math.floor(e/10),t++;return t},e.prototype.getString=function(e){for(var t="",a=e=(e||0).toString();3<a.length;)t=","+a.slice(-3)+t,a=a.slice(0,a.length-3);return a&&(t=a+t),t},__decorate([r(cc.Sprite)],e.prototype,"sprBg",void 0),__decorate([r(cc.Node)],e.prototype,"sprBg0",void 0),__decorate([r(cc.Node)],e.prototype,"sprBg1",void 0),__decorate([r(cc.Sprite)],e.prototype,"sprMedal",void 0),__decorate([r(cc.Sprite)],e.prototype,"sprHead",void 0),__decorate([r(cc.Label)],e.prototype,"lbRank",void 0),__decorate([r(cc.Label)],e.prototype,"lbName",void 0),__decorate([r(cc.Label)],e.prototype,"lbScore",void 0),__decorate([r(cc.Label)],e.prototype,"lbGrade",void 0),__decorate([r(cc.Label)],e.prototype,"lbtitle",void 0),__decorate([r([cc.SpriteFrame])],e.prototype,"medalFrames",void 0),__decorate([r([cc.SpriteFrame])],e.prototype,"bgFrames",void 0),e=__decorate([o],e)}(cc.Component);a.default=i,cc._RF.pop()},{}],Ranking:[function(e,t,a){"use strict";cc._RF.push(t,"f4f54uObghLbJK7HnlIlACQ","Ranking"),Object.defineProperty(a,"__esModule",{value:!0});var r=e("./RankingCell"),n=cc._decorator,o=n.ccclass,i=n.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ndContent=null,e.pfCell=null,e.gradeList=["王者","宗师","大师","进阶","入门","渣渣"],e.level=0,e}return __extends(e,t),e.prototype.loadRanking=function(e){for(var t=0;t<e.length;t++){var a=cc.instantiate(this.pfCell);this.ndContent.addChild(a);var n=e[t];a.getComponent(r.default).setData(t,n,!0)}},e.prototype.loadOverRanking=function(e){this.level=0,this.setTitle();for(var t=0;t<e.length;t++){var a=cc.instantiate(this.pfCell),n=e[t],o=a.getComponent(r.default).setOverData(t,n);if(this.level!=o)for(t==e.length-1&&(o=5);this.level++,this.setTitle(),!(this.level>=o););this.ndContent.addChild(a)}},e.prototype.setTitle=function(){var e=cc.instantiate(this.pfCell);this.ndContent.addChild(e),e.getComponent(r.default).setTitle(this.gradeList[this.level])},e.prototype.clear=function(){this.ndContent.removeAllChildren()},e.prototype.onLoad=function(){},e.prototype.start=function(){},__decorate([i(cc.Node)],e.prototype,"ndContent",void 0),__decorate([i(cc.Prefab)],e.prototype,"pfCell",void 0),e=__decorate([o],e)}(cc.Component);a.default=s,cc._RF.pop()},{"./RankingCell":"RankingCell"}],rankItem:[function(e,t,a){"use strict";cc._RF.push(t,"ca16cbI6Y9GYK9vh0kx6NqJ","rankItem"),Object.defineProperty(a,"__esModule",{value:!0});var n=cc._decorator,o=n.ccclass,r=n.property,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._lb_name=null,e._lb_scroe=null,e._lb_rank=null,e._img_head=null,e._modelSprite=null,e.modelSpritesFrame=[],e}return __extends(e,t),e.prototype.onLoad=function(){this.initNode()},e.prototype.initNode=function(){this._lb_name=this.node.getChildByName("lb_name"),this._lb_rank=this.node.getChildByName("lb_rank"),this._lb_scroe=this.node.getChildByName("lb_score"),this._modelSprite=this.node.getChildByName("nameFrame"),this._img_head=this.node.getChildByName("headFrame").getChildByName("head")},e.prototype.setName=function(e){this._lb_name.getComponent(cc.Label).string=e},e.prototype.setRank=function(e){this._lb_rank.getComponent(cc.Label).string=e},e.prototype.setScore=function(e){this._lb_scroe.getComponent(cc.Label).string=e},e.prototype.setHeadImg=function(e){var t=this._img_head.getComponent(cc.Sprite);this.createImage(e,t)},e.prototype.setModel=function(e){this._modelSprite.getComponent(cc.Sprite).spriteFrame=this.modelSpritesFrame[e]},e.prototype.createImage=function(e,a){var t=this;if(null!=window.wx)try{var n=wx.createImage();n.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(n),e.handleLoadedTexture(),a.spriteFrame=new cc.SpriteFrame(e)}catch(e){cc.log(e),t._img_head.active=!1}},n.src=e}catch(e){cc.log(e),this._img_head.active=!1}else cc.loader.load({url:e,type:"jpg"},function(e,t){a.spriteFrame=new cc.SpriteFrame(t)})},__decorate([r(cc.SpriteFrame)],e.prototype,"modelSpritesFrame",void 0),e=__decorate([o],e)}(cc.Component);a.default=i,cc._RF.pop()},{}]},{},["CanvasCtr","Ranking","RankingCell","rankItem"]);